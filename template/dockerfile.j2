###########################################################################
#          This file was auto-generated by configuration script.          #
#                 Do not make any manual changes here!!!                  #
#-------------------------------------------------------------------------#
#                                                                         #
# main dockerfile                                                         #
###########################################################################

##
# Unbound dockerfile based on Alpine version {{version_alpine}} and exported as: {{db.docker_tag}}:{{version_build}}


# Image source
FROM {{db.image.source}}.{{version_alpine_build}}

# Description:
LABEL description="Recursive, caching DNS resolver based on Unbound version: {{version_unbound}}"


# Maintainer
LABEL maintainer="Rafal Niznik"


# Enviroment variables:
ENV ENV_VERSION_ALPINE={{version_alpine}}
ENV ENV_VERSION_UNBOUND={{version_unbound}}
ENV ENV_VERSION_BUILD="{{version_build}}"


# Install all packages:
RUN echo "Build:{{version_build}}"
RUN apk add unbound
RUN rm -rf /var/cache/apk/* /tmp/*


# Crete all required folders:
RUN mkdir -p /cfg/unbound/cfg.d
RUN chown -R unbound:unbound /cfg


# Redirect logs to {{db.runtime}}:
RUN touch /var/log/unbound.log
RUN chown unbound:unbound /var/log/unbound.log
RUN ln -sf /dev/stdout /var/log/unbound.log 


# Copy all generated files:
COPY unbound.conf /etc/unbound/
COPY default.cfg /cfg/unbound/


# Example frorwarding goes here:
#COPY example.cfg /cfg/unbound/cfg.d/


# Expose all required ports:
EXPOSE 53/tcp
EXPOSE 53/udp


#HEALTHCHECK --interval=5s --timeout=3s --start-period=5s CMD drill @127.0.0.1 cloudflare.com || exit 1


# Run default command:
#CMD ["/bin/sh"]
CMD ["unbound"]


# Note:
# To build image use:
# docker build . -f <dockerfile> -t {{db.docker_tag}}:{{version_build}}


